'use strict';for(var setUrl="/global/survey/engine/data/index.php?a=s",surveyQTypes,currentSurvey,qTypes={},yesNo=[{label:"Yes",id:1},{label:"No",id:0}],fiveStar=[],x=1;5>=x;x++)fiveStar.push({label:x,id:x});for(var tenStar=fiveStar.slice(),x=6;10>=x;x++)tenStar.push({label:x,id:x});
var operators={"==":function(b,d){return"undefined"===typeof b?!1:$.isArray(b)?0<=b.indexOf(parseInt(d)):b==d},"!=":function(b,d){return"undefined"===typeof b?!1:$.isArray(b)?0>b.indexOf(parseInt(d)):b!=d},"<=":function(b,d){return"undefined"===typeof b?!1:parseInt(b)<=parseInt(d)},">=":function(b,d){return"undefined"===typeof b?!1:parseInt(b)>=parseInt(d)},"<":function(b,d){return"undefined"===typeof b?!1:parseInt(b)<parseInt(d)},">":function(b,d){return"undefined"===typeof b?!1:parseInt(b)>parseInt(d)}};
$(function(){var b=window.location.pathname;"/"!=b[0]&&(b="/"+b);var d=document.cookie.split(";"),n=!1,a=[];$.each(d,function(b,d){var h=d.trim();"ignoreAllSurveys"==h&&(n=!0);"surveyComplete"==h.substring(0,14)&&a.push(parseInt(h.substring(14,h.indexOf("="))))});n||$.get("/global/survey/engine/data/index.php",{a:"g",p:b}).success(function(b){surveyQTypes=b.types;$.each(b.survey,function(b,d){if(0>a.indexOf(parseInt(d.id)))return document.cookie="surveyComplete"+d.id+"=1; path=/;expires=Fri, 31 Dec 9999 23:59:59 GMT",
showSurvey(d),!1})})});
var saveSurvey=function(b){var d={};$.each(currentSurvey.questions,function(b,a){var f=$("#q"+a.id),e;switch(surveyQTypes[a.type].ui_element){case "radio":e=$("> div > div > div >input:checked",f).val();break;case "checkbox":e=[];$.each($("> div > div > div >input:checked",f),function(b,d){e.push($(d).val())});break;case "input":case "textarea":e=$("> div > div > div >"+surveyQTypes[a.type].ui_element,f).val()}"undefined"!==typeof e&&""!=e&&(d[a.id]=e)});document.cookie="surveyComplete"+currentSurvey.id+
"=1; path=/;expires=Thu, 01 Jan 1970 00:00:00 UTC";document.cookie="survey"+currentSurvey.id+"="+JSON.stringify(d)+"; path=/";$.fancybox.close()},submitSurvey=function(b){var d=[];b.preventDefault();$.each(currentSurvey.questions,function(b,a){var f=$("#q"+a.id),e;if(f.is(":visible")){switch(surveyQTypes[a.type].ui_element){case "radio":e=$("> div > div > div >input:checked",f).val();break;case "checkbox":e=[];$.each($("> div > div > div >input:checked",f),function(b,d){e.push($(d).val())});break;
case "input":case "textarea":e=$("> div > div > div >"+surveyQTypes[a.type].ui_element,f).val()}"undefined"!==typeof e&&""!=e&&d.push({id:a.id,a:e})}});$.post(setUrl,{s:currentSurvey.id,q:JSON.stringify(d)},function(b){});$.fancybox.close();"undefined"!==typeof currentSurvey.thanks&&$.fancybox.open({maxWidth:540,autoSize:!0,transitionIn:"none",transitionOut:"none",type:"iframe",content:"<div class='thanks'>"+currentSurvey.thanks+"</div>"})},showSurvey=function(b){currentSurvey=b;var d={},n=1,a=document.cookie.split(";"),
f={};$.each(a,function(d,c){var g=c.trim().split("=");2==g.length&&g[0]=="survey"+b.id&&"complete"!=g[1]&&(f=JSON.parse(g[1]))});var a=jQuery("<div/>"),e=jQuery("<div/>",{text:b.welcome,"class":"welcome"}),h=jQuery('<form name="survey_form" id="survey_form">'),k=jQuery("<input/>",{type:"hidden",name:"surveyID",id:"surveyID",value:b.id}).appendTo(h);$.each(b.questions,function(b,c){qTypes[c.id]=c.type;var g=d[c.id]=jQuery("<div/>",{id:"q"+c.id,text:c.label}),a;a="";c.attr&&c.attr.alignment&&(a=c.attr.alignment);
c.conditions?(a=jQuery("<div/>"),g.addClass("conditional"),$.each(c.conditions,function(b,a){var e=d[a.qid],f;switch(surveyQTypes[qTypes[a.qid]].ui_element){case "radio":operators[a.method]($("> div > div > div >input:checked",e).val(),a.value)||g.hide();break;case "checkbox":f=[];$.each($("> div > div > div >input:checked",e),function(b,c){f.push(parseInt($(c).val()))});operators[a.method](f,a.value)||g.hide();break;case "input":case "textarea":operators[a.method]($("> div > div > div >"+surveyQTypes[c.type].ui_element,
e).val(),a.value)||g.hide()}})):(g.text(n++ +". "),a=jQuery("<div/>",{text:c.label,"class":"question "+a}));var e=jQuery("<div/>").appendTo(a),l,m=surveyQTypes[c.type].ui_element;switch(c.type){case "L":case "MC":l=c.answers||[];break;case "Y":l=yesNo;break;case "R1":l=tenStar;break;case "R5":l=fiveStar}("R1"==c.type||"R5"==c.type)&&c.attr&&c.attr.reverseorder&&1==c.attr.reverseorder&&l.reverse();"radio"==m||"checkbox"==m?$.each(l,function(b,a){k=jQuery("<input/>",{type:m,name:"q"+c.id,value:a.id,
id:"q"+c.id+"-"+a.id});"radio"==m?"undefined"!==typeof f[c.id]&&f[c.id]==a.id&&k.prop("checked",!0):"undefined"!==typeof f[c.id]&&0<=f[c.id].indexOf(a.id.toString())&&k.prop("checked",!0);var d=jQuery("<label/>",{text:a.label,for:"q"+c.id+"-"+a.id}),d=$("<div>",{class:"choice"}).append(k,d);e.append(d)}):"input"==m?(k=jQuery("<input/>",{type:"text",name:"q"+c.id}),"undefined"!==typeof f[c.id]&&k.text(f[c.id]),l=$("<div>",{class:"choice"}).append(k),e.append(l)):"textarea"==m&&(k=jQuery("<textarea/>",
{name:"q"+c.id}),"undefined"!==typeof f[c.id]&&k.text(f[c.id]),l=$("<div>",{class:"choice full"}).append(k),e.append(l));a.appendTo(g);c.conditions&&c.conditions.length?(a=$("> div > div > div >input[value='"+c.conditions[0].value+"']",d[c.conditions[0].qid]))?c.attr&&"undefined"!==typeof c.attr.placement?"end"==c.attr.placement&&(a=a.parent().parent(),g.appendTo(a)):g.insertAfter(a.next()):g.appendTo(d[c.conditions[0].qid]):g.appendTo(h)});jQuery("<input/>",{type:"submit",value:"Submit",id:"submitForm"}).click(submitSurvey).appendTo(h);
$("input",h).change(function(){var a=$(this),c=a.attr("name").substring(1),d=a.val();"checkbox"==surveyQTypes[qTypes[c]].ui_element&&(d=[],$.each($("> div > input:checked",a.parent().parent()),function(b,a){d.push(parseInt($(a).val()))}));$.each(b.questions,function(b,a){if(a.conditions){var e=!1,f=!1;$.each(a.conditions,function(a,b){b.qid==c&&(f=!0,operators[b.method](d,b.value)&&(e=!0))});f&&e?$("#q"+a.id).show():f&&$("#q"+a.id).hide()}})});a.append(e,h);$.fancybox.open({maxWidth:540,maxHeight:"75%",
autoScale:!1,autoDimensions:!1,fitToView:!1,width:"100%",height:"100%",autoSize:!1,transitionIn:"none",transitionOut:"none",closeBtn:!1,type:"iframe",content:a,helpers:{overlay:{closeClick:!1}},afterLoad:function(){var a=$("<span/>",{id:"resumeBtn",text:"Resume in 5 minutes"}).click(function(){saveSurvey();$.fancybox.close();var a=new Date;a.setTime(a.getTime()+3E5);document.cookie="surveyComplete"+b.id+"=1; path=/;expires="+a.toGMTString()}),c=$("<span/>",{id:"neveraskBtn",text:"Never show this again"}).click(function(){$.fancybox.close()});
$(".fancybox-outer").prepend($("<span/>",{"class":"top_buttons"}).append(a,c))}})};
