<?php
require_once 'global/includes/utils/utils.inc';
require_once 'global/includes/utils/Neic.inc';
$neic      = new NEIC();
?>
<?php
	switch($l2page){
		case 'page_pet':
			/*
			3804 = PSR
			3887 = TWIP
			4728 = PSM 
			4729 = PMM
			5043 = STEO
			6927 = AEO
			5338 = Reserves report
			8087 = DPR 
			5469 = EIA-914
			5427 = Monthly Biodiesel
			29772 = Crude by Rail
			27793 = Hyrdocarbon Gas Liquids
			32373 = Crude Oil Exports report
			32813 = PADD5 Trans Fuel study
			*/
			$RAP = [
                "",
				"4728,5469,29772,32373,4729",
      			"4728,5469,29772,32373,4729",
      			"4728,5469,29772,32373,4729",
      			"4728,5469,29772,32373,4729",
      			"4728,5469,29772,32373,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,5469,29772,32373,32813,4729",
      			"4728,4729,5469,5043,8087",
      			"4728,4729,5469,5043,8087",
      			"4728,4729,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,4728,5469,5043,8087",
      			"3887,3804,5043,8087,32813",
      			"3887,3804,5043,8087,32813",
      			"3887,3804,5043,8087,32813",
      			"3887,3804,5043,8087,32813",
      			"3887,29772,30834,4728,32813",
      			"3887,29772,30834,4728,32813",
      			"29772,3887,30834,4728,32813",
      			"29772,3887,30834,4728,32813"
			];	
			break;
		case 'page_nat':
		/*
		3863 = NGWU
		3862 = WNGSR
		5127 = NGM
		5469 = Crude & NG Production
		7025 = STEO - natural gas section 
        8087 = DPR 
		27313 = Effect of Increased Levels of Liquefied Natural Gas Exports on U.S. Energy Markets 
		27793 = Hyrdocarbon Gas Liquids
		38795 = SoCal report
		4699  = NGA
		*/
			$RAP=[
                "",
				"3863,7025,5127,5469",
      			"3863,7025,5127,3862",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,512738795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,38795",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
     			"3863,4699,5127,7025",
      			"3863,4699,5127,7025",
      			"3863,38795,5127,8087",
      			"3863,38795,5127,8087"
			];
			break;
		case 'page_coa':
			/*
			3864 = WCP
			4564 = ACR
			7020 = STEO - coal section 
			7023 = MER - coal section
			*/
			$RAP = [
                "",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,5570,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,7020,7023",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008",
				"3864,4564,5570,4008"

			];
			break;
		case 'page_ele':
			/*
			5073 = EPM
			5247 = EMU
			7010 = STEO - electricity section 
			30773 = Analysis of Impacts of CPP
			7009 = MER - electricity section
			*/
			$RAP = [
                "",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7009,30773",
			   "5073,5247,7010,30773",
			   "5073,5247,7010,30773",
			   "5073,5247,7010,30773",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009",
			   "5073,5247,7010,7009"
			];
			break;
		case 'page_con':
			$RAP = [
                "",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912",
			   "6927,7027,25967,28773,30912"
			];
			break;
		case 'page_ren':
			/*
			5073 = EPM
			5427 = Monthly Biodiesel
			7031 = STEO - renewables section 
			30773 = Analysis of Impacts of CPP
			7029 = MER - renewables section
			4820 = AFV
			*/
			$RAP = [
                "",
			   "7029,7031,5427,30773",
			   "7029,7031,5427,30773",
			   "7029,7031,5427,30773",
			   "7029,7031,5427,30773",
			   "7029,7031,5427,30773",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820",
			   "7029,7031,5427,30773,4820"
			];
			break;
		case 'page_nuc':
			/*
			6227 = Uranium Marketing Annual
			4726 = MER
			4620 = DUPR - Annual
			5043 = STEO 
			4380 = DUPR - Quarterly
			*/
			$RAP = [
                "",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "5073,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4726,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "6227,4380,5043,4620",
			   "5073,4380,5043,4620",
			   "5073,4380,5043,4620",
			   "5073,4380,5043,4620",
			   "5073,4380,5043,4620",
			   "5073,4380,5043,4620"
			];
			break;
		case 'page_tot':
			/*
			5043 = STEO
			6927 = AEO
			4726 = MER 
			6647 = IEO
			30773 = Analysis of Impacts of CPP
			*/
			$RAP = [
                "",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927",
			   "4726,5043,30773,6927"
			];
			break;
		case 'page_ana':
			/*
			5043 = STEO
			6927 = AEO
			4726 = MER 
			6647 = IEO
			3887 = TWIP
			3863 = NGWU
			30412 = Implications of LTO
			32373 = Crude Oil Exports report
			30773 = Analysis of Impacts of CPP
			32813 = PADD5 study
			*/
			$RAP = [
                "",
				"3887,6647,5043,36415,6927",
     			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"3887,6647,5043,36415,6927",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
     			"32373,5043,30412,6927,32813",
     			"32373,5043,30412,6927,32813",
     			"32373,5043,30412,6927,32813",
      			"32373,5043,30412,6927,32813",
     			"5043,32373,30834,6647,6927,32813",
     			"5043,32373,30834,6647,6927,32813",
      			"5043,32373,30834,6647,6927,32813",
     			"5043,32373,30834,6647,6927,32813",
     			"3887,32373,30834,6647,6927,32813",
     			"3887,6647,5043,6927",
     			"3887,6647,5043,6927",
     			"3887,6647,5043,6927",
   				"3887,6647,5043,6927",
    			"3887,6647,5043,6927",
   				"3887,6647,5043,6927"
			];
			break;
		case 'page_fin':
			$RAP = [
                "",
			   "3863,5043,5127,8087",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,3863,3887",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043",
			   "6687,26370,6387,5043"
			];
			break;
		case 'page_env':
			$RAP = [
                "",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6647,6607",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293",
			   "4726,5043,6867,29293"
			];
			break;
	}

/* NOTE:
1. PossibleTagsQuery has already executed by it_universal.cfm (called by carousel.cfm) and can be reused
2. IssuesTrendsQuery in that same file cannot be reused because it involves the ISSUESTRENDS table. Instead, the query "recent_AP" below gets the Bookshelf reports
*/

$exploded   = explode(',',$RAP[date('j')]);
//print_r($exploded);

//hsh_sql:
//associated with query name recent_AP
$bindVariables = array();

$j = 0;
$tmp_v2 = '';
$qualifierArr = $exploded;
foreach($qualifierArr as $v1) {
	$val = trim($v1);
	if($val) {
		if($tmp_v2 !== '')
			$tmp_v2 .= ", :tmpKey_v1" . $j;
		else
			$tmp_v2 = " :tmpKey_v1" . $j;

		$bindVariables[':tmpKey_v1' . $j] = $val;
		$j++;
	}
}

$neic->sql = " select
	TITLE, RELEASE_DATE, PERIODICITY, HAS_ANALYSIS, HAS_DATA, HAS_FORECAST, LINK_HTML,
	listagg(TAGID, ',') within group (order by REPORT_COUNTS desc) as reporttags,
	listagg(TAG, ',') within group (order by REPORT_COUNTS desc) as reporttagnames
  from (
    select
		distinct TITLE,
		RELEASE_DATE,
		PERIODICITY,
		HAS_ANALYSIS,
		HAS_DATA,
		HAS_FORECAST,
		LINK_HTML,
		TAGID,
		TAG,
		REPORT_COUNTS
    from NEIC.ARCHIVES_REPORT_LIST ar_list
    inner join NEIC.ARCHIVES_REPORT_LU ar_lu
      on ar_list.ID = ar_lu.ID
    inner join NEIC.ARCHIVES_REPORT_TAG ar_tag
      on ar_lu.TAGID = ar_tag.ID
    where
		ar_list.ID in ( " . $tmp_v2 . " )
        and
        ar_tag.ID <> :tag
  )
  group by TITLE, RELEASE_DATE, PERIODICITY, HAS_ANALYSIS, HAS_DATA, HAS_FORECAST, LINK_HTML
  order by RELEASE_DATE desc
 ";

$bindVariables[":tag"] = $CorrespondingTag;


//print $neic->sql;
//print_r($bindVariables);

$recent_AP = $neic->get($bindVariables);
//print_r($recent_AP);

?>
<span class="side_col right"><h1>Recent Analysis &amp; Projections</h1>
<ul class="analysis-projections">
 <?php
		foreach($recent_AP as $row) {
        $DataTypesArray = [];
        $filename = "";
        if(strtolower($row['has_data']) == "y"){
            $DataTypesArray[] = "Data";
            $filename .= "d";
        }
        if(strtolower($row['has_analysis']) == "y"){
            $DataTypesArray[] = "Analysis";
            $filename .= "a";
        }
        if(strtolower($row['has_forecast']) == "y"){
            $DataTypesArray[] = "Forecast";
            $filename .= "p";
        }

        $TitleText = "Report Type";
        if(count($DataTypesArray)>1)
            $TitleText .= "s";

        $TitleText .= ": ";

        $count=count($DataTypesArray);
        for($x=0;$x<$count;$x++){
            $TitleText .= $DataTypesArray[$x];
            if($x<$count-1)
                $TitleText .= ", ";
        }

        echo '<li><img src="/global/images/icons/dap/'.$filename.'.png" title="'.$TitleText.'"/>';
        echo PHP_EOL;
        echo '<span><h3>';
        echo PHP_EOL;

        if(strlen($row['link_html']))
            echo "<a href=\"".$row['link_html']."\">".$row['title']."</a>";
        else
            echo $row['title'];

        echo PHP_EOL;
        echo '</h3>';
        echo PHP_EOL;
        echo "<em>Released ".date('F d, Y',strtotime($row['release_date']))."</em>";
        echo PHP_EOL;

        $thetags = $row['reporttags'];
        $thetagnames = $row['reporttagnames'];
        $thetitle = $row['title'];
        $thelink = $row['link_html'];

        include "it_displaytags.inc";

				echo "</span>";
				echo PHP_EOL;

        echo "</li>";
				echo PHP_EOL;
    }
?>
</ul>
<p><a href="reports.cfm"><b>See more analysis &amp; projections &rsaquo;</b></a></p>
